<!DOCTYPE html>
<html>
<head>
	<title>Local Storage, etc</title>
	<link href="../style.css" rel="stylesheet"/>
	<style>
		#note {
			resize:both;
			width:500px;
		}
		
		#display, span {
			color:white;
			font-size:0.8em;
		}
	</style>
</head>
<body>
	<h1>Leave a note for yourself</h1>
	<div id="display">
		<span id="nameDis">Name</span> | <span id="locationDis">Location</span> | <span id="timeDis">Time</span>
	</div>
	<textarea id="note" rows="10"></textarea>
	<form id="form">
		<input type="text" id="name" placeholder="name" />
		<input type="text" id="location" placeholder="location" />
		<input type="button" id="submit" value="submit" />
	</form>
	<span id="errMsg"></span>
	<div class="nav">
		<a href="../index.html">home</a>
	</div>
<script>
	
//checks to see if browser supports Local Storage API
if (typeof(Storage) !== "undefined") {

	//variables for local storage, buttons, displays, and inputs
	var ls = window.localStorage;
	var note = document.getElementById('note');
	var submit = document.getElementById('submit');
	var nameDis = document.getElementById('nameDis');
	var locationDis = document.getElementById('locationDis');
	var timeDis = document.getElementById('timeDis');
	
	//object constructor used for name location and time input shown in display
	function DATA(name, userLocation){
		this.name =  name,
		this.location = userLocation,
		this.time = new Date().toLocaleString()
	}
	
	//gets display data from Local Storage and displays it
	function displayMeta(){
	
			//the object that is stored as a string needs to be parsed
			var parsedData = JSON.parse(ls.meta);
			
			//each bit of hmtl is set to the relevant data
			nameDis.innerHTML = parsedData.name;
			timeDis.innerHTML = parsedData.time;
			locationDis.innerHTML = parsedData.location;
			
			//removes any err message that might have been displayed
			document.getElementById('errMsg').innerHTML = '';
	}
	
	//retreives relevant data onload
	window.onload = function(){
		if(ls.note){
			note.value = ls.note;
		}
		if(ls.meta){
			displayMeta();
		}
	}
	
	//the note is updated on each key up 
	//unlike the display data which is updated on submit
	note.addEventListener('keyup', function(){
		var currentNote = document.getElementById('note').value;
		ls.setItem('note', currentNote);
	});
	
	//submit button to update display data (name, location, time)
	submit.addEventListener('click', function(){
		
		//getting the relevant parts
		var name = document.getElementById('name').value;
		var userLocation = document.getElementById('location').value;
		
		//the conditionals do form validation
		if(name){
			if(userLocation){
			
				//if both pieces are supplied we use the object constructor
				var data = new DATA(name, userLocation);
				
				//the object is stringified before being set in local storage
				var json = JSON.stringify(data);

				//we use our previously delared ls variable which references window.localStorage
				ls.setItem('meta', json);
				
				//then we call our function to update the data from what's been stored
				displayMeta();
			}
			else{
				//display missing location err
				document.getElementById('errMsg').innerHTML = 'You are missing a location';
			}
		}
		else{
			if(userLocation){
				//display missing name err
				document.getElementById('errMsg').innerHTML = 'You are missing your name';
			}
			else{
				//display missing data err
				document.getElementById('errMsg').innerHTML = 'You are missing name and location';
			}
		}
	});
	
}
else{
	var note = document.getElementById('note');
	var err = document.createElement('h1');
	var errText = document.createTextNode('ERR: Your browser does not support Local Storage');
	err.appendChild(errText);
	note.appendChild(err);
}
</script>
</body>
</html>