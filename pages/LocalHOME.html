<!DOCTYPE html>
<html>
<head>
	<title>Local Storage, etc</title>
	<link href="../style.css" rel="stylesheet"/>
	<style>
		#note {
			resize:both;
			width:500px;
		}
		
		#display, span {
			color:white;
			font-size:0.8em;
		}
		
		#errMsg {
			color: red;
		}
		
	</style>
</head>
<body>
	<h1>Local Storage API</h1>
	<h3>
	Use the form to store simple data and an object.
	An array and an associate array is made and stored in the script.
	</h3>
	<ul>
		<li>simple data = note to self (string)</li>
		<li>object = name, location, and time</li>
		<li>array = primary colors</li>
		<li>associative array = first and last names</li>
	</ul>
	<div id="display">
		<span id="nameDis">Name</span> | <span id="locationDis">Location</span> | <span id="timeDis">Time</span>
	</div>
	<textarea id="note" rows="10"></textarea>
	<form id="form">
		<input type="text" id="name" placeholder="name" />
		<input type="text" id="location" placeholder="location" />
		<input type="button" id="submit" value="submit" />
	</form>
	<span id="errMsg"></span>
	<div id="colorsANDnames">
<pre>
3 Colors that come from an array that 
is stored in local storage when the page loads
if it is not already stored.
</pre>
		<span id="colors">Nothing stored in local storage yet for colors</span>
		
<pre>
These buttons are made after an associative array in the script is stored and
then read. The value of each button is a key in the array and by clicking it
the value changes to the value stored in the associative array.
</pre>
		<span id="names">Nothing stored in local storage yet for names</span>
	</div>
	<div class="nav">
		<a href="../index.html">home</a>
	</div>
<script>
	
//checks to see if browser supports Local Storage API
if (typeof(Storage) !== "undefined") {

	//variables for local storage
	var ls = window.localStorage;
	
	//inputs
	var note = document.getElementById('note');
	var submit = document.getElementById('submit');
	
	//displays
	var nameDis = document.getElementById('nameDis');
	var locationDis = document.getElementById('locationDis');
	var timeDis = document.getElementById('timeDis');
	var colorsDis = document.getElementById('colors');
	var namesDis = document.getElementById('names');
	
	//object constructor used for name, location, and time input shown in displays
	function DATA(name, userLocation){
		this.name =  name,
		this.location = userLocation,
		this.time = new Date().toLocaleString()
	}
	
	//gets display data from Local Storage and displays it
	function displayMeta(){
	
			//the object that is stored as a string needs to be parsed
			var parsedData = JSON.parse(ls.meta);
			
			//each bit of hmtl is set to the relevant data
			nameDis.innerHTML = parsedData.name;
			timeDis.innerHTML = parsedData.time;
			locationDis.innerHTML = parsedData.location;
			
			//removes any err message that might have been displayed
			document.getElementById('errMsg').innerHTML = '';
	}
	
	//retreives relevant data onload
	window.onload = function(){
	
		//the note and the displays are loaded independently because they are stored at different times
		if(ls.note){
			note.value = ls.note;
		}
		if(ls.meta){
			displayMeta();
		}
	}
	
	//the note is updated on each key up 
	//unlike the display data which is updated on submit
	note.addEventListener('keyup', function(){
		var currentNote = document.getElementById('note').value;
		ls.setItem('note', currentNote);
	});
	
	//submit button to update display data (name, location, time)
	submit.addEventListener('click', function(){
		
		//getting the relevant parts
		var name = document.getElementById('name').value;
		var userLocation = document.getElementById('location').value;
		
		//the conditionals do form validation
		if(name){
			if(userLocation){
			
				//if both pieces are supplied we use the object constructor
				var data = new DATA(name, userLocation);
				
				//the object is stringified before being set in local storage
				var json = JSON.stringify(data);

				//we use our previously delared ls variable which references window.localStorage
				ls.setItem('meta', json);
				
				//then we call our function to update the data from what's been stored
				displayMeta();
			}
			else{
				//display missing location err
				document.getElementById('errMsg').innerHTML = '* You are missing a location';
			}
		}
		else{
			if(userLocation){
				//display missing name err
				document.getElementById('errMsg').innerHTML = '* You are missing your name';
			}
			else{
				//display missing data err
				document.getElementById('errMsg').innerHTML = '* You are missing name and location';
			}
		}
	});
	
	if(!ls.names || !ls.primaryColors){
		//an array
		let colors = ['red','blue','yellow'];
		ls.setItem('primaryColors', colors);
		
		//an associative array 
		var names = {
			'Bob': 'Lawbla',
			'Mike': 'Hat',
			'Mitch': 'Higgin'
		}
		ls.setItem('names', JSON.stringify(names));
	}
	else{
	
		//add associative array buttons
		namesDis.innerHTML = '';
		var nameObj = JSON.parse(ls.names);
		var keys = Object.keys(nameObj);
		for(key in keys){
			let button = document.createElement('input');
			button.type = 'button';
			button.classList.add('lookupToggle');
			button.value = keys[key];
			namesDis.appendChild(button);
		}
		
		//add functionality to buttons
		var btns = document.getElementsByClassName('lookupToggle');
		for(btn in btns){
			if(btns[btn].value){
			btns[btn].addEventListener('click', function(){
				this.value = nameObj[this.value];
				this.disabled = true;
			});
			}
		};
		
		colorsDis.innerHTML = ls.primaryColors.toString().split(',').join(' ');
	}
}
else{
	var note = document.getElementById('note');
	var err = document.createElement('h1');
	var errText = document.createTextNode('ERR: Your browser does not support Local Storage');
	err.appendChild(errText);
	note.appendChild(err);
}
</script>
</body>
</html>