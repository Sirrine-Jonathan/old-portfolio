<!DOCTYPE html>
<html>
<head>
	<title>Local Storage, etc</title>
	<link href="../style.css" rel="stylesheet"/>
	<style>
		#note {
			resize:both;
			width:500px;
		}
		
		#display, span {
			color:white;
			font-size:0.8em;
		}
	</style>
</head>
<body>
	<h1>Leave a note for yourself</h1>
	<div id="display">
		<span id="nameDis">Name</span> | <span id="locationDis">Location</span> | <span id="timeDis">Time</span>
	</div>
	<textarea id="note" rows="10"></textarea>
	<form id="form">
		<input type="text" id="name" placeholder="name" />
		<input type="text" id="location" placeholder="location" />
		<input type="button" id="submit" value="submit" />
	</form>
	<span id="errMsg"></span>
	<div class="nav">
		<a href="../index.html">home</a>
	</div>
<script>
	
if (typeof(Storage) !== "undefined") {

	//variables for local storage, buttons, displays, and inputs
	var ls = window.localStorage;
	var note = document.getElementById('note');
	var submit = document.getElementById('submit');
	var nameDis = document.getElementById('nameDis');
	var locationDis = document.getElementById('locationDis');
	var timeDis = document.getElementById('timeDis');
	
	//function that creates an object
	function createJSON(name, userLocation){
		this.name =  name,
		this.location = userLocation,
		this.time = new Date().toLocaleString()
		return this;
	}
	function displayMeta(){
			var parsedData = JSON.parse(ls.meta);
			nameDis.innerHTML = parsedData.name;
			timeDis.innerHTML = parsedData.time;
			locationDis.innerHTML = parsedData.location;
			document.getElementById('errMsg').innerHTML = '';
	}
	
	//retreives relevant data onload
	window.onload = function(){
		if(ls.note){
			note.value = ls.note;
		}
		if(ls.meta){
			displayMeta();
		}
	}
	
	note.addEventListener('keyup', function(){
		var currentNote = document.getElementById('note').value;
		ls.setItem('note', currentNote);
	});
	
	submit.addEventListener('click', function(){
		
		//getting the relevant parts
		var name = document.getElementById('name').value;
		var userLocation = document.getElementById('location').value;
		if(name){
			if(userLocation){
				var data = createJSON(name, userLocation);
				var json = JSON.stringify(data);
				ls.setItem('meta', json);
				displayMeta();
			}
			else{
				//display missing location err
				document.getElementById('errMsg').innerHTML = 'You are missing a location';
			}
		}
		else{
			if(userLocation){
				//display missing name err
				document.getElementById('errMsg').innerHTML = 'You are missing your name';
			}
			else{
				//display missing location err
				document.getElementById('errMsg').innerHTML = 'You are missing name and location';
			}
		}
	});
	
}
else{
	var note = document.getElementById('note');
	var err = document.createElement('h1');
	var errText = document.createTextNode('ERR: Your browser does not support Local Storage');
	err.appendChild(errText);
	note.appendChild(err);
}
</script>
</body>
</html>